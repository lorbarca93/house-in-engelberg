# Security Audit Report
**Date**: 2025-11-26  
**Scope**: Website HTML files and Python generation scripts  
**Auditor**: Automated Security Check

## Executive Summary

This security audit examined the Engelberg Property Investment Simulation website for common web security vulnerabilities. The website consists of static HTML reports generated by Python scripts. Overall, the site has a **LOW RISK** profile as it's a static site with no user input or server-side processing. However, several security improvements are recommended.

## Risk Assessment

**Overall Risk Level**: üü° **MEDIUM-LOW**

- **Static Site**: No server-side processing reduces attack surface
- **No User Input**: No forms or user-submitted data
- **External Dependencies**: Uses CDN resources (requires integrity checks)
- **Missing Security Headers**: No Content Security Policy or security headers
- **Inline Event Handlers**: Some onclick handlers present (low risk for static site)

---

## Findings

### ‚úÖ LOW RISK Issues

#### 1. Inline Event Handlers
**Location**: 
- `website/index.html` (lines 270, 279, 288, 297, 306, 315)
- `website/report_portal.html` (lines 599-602)

**Issue**: Inline `onclick` handlers are present:
```html
<div class="report-card" onclick="window.location.href='report_base_case.html'">
<button class="nav-tab active" onclick="showTab('base-case')">
```

**Risk**: Low - These are hardcoded values, not user input. However, inline handlers are generally discouraged for maintainability and CSP compliance.

**Recommendation**: 
- Replace with event listeners in JavaScript
- Use `addEventListener` instead of inline handlers
- Improves CSP compatibility

**Priority**: Low

---

#### 2. Missing Content Security Policy (CSP)
**Location**: All HTML files

**Issue**: No Content Security Policy headers or meta tags are present.

**Risk**: Medium - Without CSP, the site is vulnerable to XSS attacks if any external resources are compromised.

**Recommendation**: Add CSP meta tag or HTTP header:
```html
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; 
               script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdn.plot.ly https://cdnjs.cloudflare.com; 
               style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; 
               font-src 'self' https://cdnjs.cloudflare.com; 
               img-src 'self' data:; 
               connect-src 'self';">
```

**Priority**: Medium

---

#### 3. Missing Security Headers
**Location**: All HTML files

**Issue**: No security headers are present:
- `X-Frame-Options`: Prevents clickjacking
- `X-Content-Type-Options`: Prevents MIME sniffing
- `Referrer-Policy`: Controls referrer information
- `Permissions-Policy`: Controls browser features

**Risk**: Low-Medium - Missing headers reduce defense-in-depth.

**Recommendation**: Add security headers (via meta tags or server configuration):
```html
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
```

**Priority**: Medium

---

### ‚úÖ GOOD Security Practices Found

#### 1. HTTPS CDN Resources
**Status**: ‚úÖ All external resources use HTTPS
- `https://cdn.jsdelivr.net`
- `https://cdn.plot.ly`
- `https://cdnjs.cloudflare.com`

**Assessment**: Good - All CDN links use secure HTTPS protocol.

---

#### 2. Subresource Integrity (SRI)
**Status**: ‚ö†Ô∏è Partial

**Found**: Plotly CDN includes integrity hash:
```html
<script src="https://cdn.plot.ly/plotly-3.3.0.min.js" 
        integrity="sha256-bO3dS6yCpk9aK4gUpNELtCiDeSYvGYnK7jFI58NQnHI=" 
        crossorigin="anonymous">
```

**Missing**: 
- ApexCharts CDN (`https://cdn.jsdelivr.net/npm/apexcharts@3.44.0`) - No integrity hash
- Font Awesome CDN (`https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css`) - No integrity hash

**Risk**: Low-Medium - Without SRI, compromised CDN could serve malicious code.

**Recommendation**: Add integrity hashes to all external scripts and stylesheets:
```html
<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.44.0" 
        integrity="sha256-..." 
        crossorigin="anonymous"></script>
```

**Priority**: Medium

---

#### 3. No User Input Processing
**Status**: ‚úÖ Good

**Assessment**: The site is static with no forms, user input, or server-side processing. This significantly reduces attack surface.

**No XSS vulnerabilities found** - All data is generated server-side from Python calculations, not user input.

---

#### 4. No Hardcoded Secrets
**Status**: ‚úÖ Good

**Assessment**: No API keys, passwords, tokens, or credentials found in the codebase.

**Note**: The `scripts/push_to_github.ps1` mentions GitHub tokens, but these are user-provided, not hardcoded.

---

### ‚ö†Ô∏è MEDIUM RISK Issues

#### 1. No HTML Escaping in Python Code
**Location**: All `analysis_*.py` files

**Issue**: Python code uses f-strings and `.format()` to insert values into HTML without explicit HTML escaping:
```python
f"{results['purchase_price']:,.0f} CHF"
f"{config.financing.num_owners}"
```

**Risk**: Low-Medium - Since all values are numeric or from controlled calculations (not user input), the risk is low. However, if the code is ever extended to accept user input, this could become a vulnerability.

**Recommendation**: 
- Import `html.escape` from Python's `html` module
- Escape all string values before inserting into HTML:
```python
from html import escape
f"{escape(str(results['purchase_price'])):,.0f} CHF"
```

**Priority**: Low (but good practice)

---

#### 2. Inline JavaScript
**Location**: All HTML files contain inline `<script>` tags

**Issue**: JavaScript is embedded directly in HTML files rather than external files.

**Risk**: Low - For a static site, this is acceptable, but it makes CSP more complex (requires 'unsafe-inline').

**Recommendation**: 
- Consider moving JavaScript to external `.js` files
- Improves caching and CSP compatibility
- Better separation of concerns

**Priority**: Low

---

## Recommendations Summary

### High Priority
None - No critical vulnerabilities found.

### Medium Priority
1. **Add Content Security Policy** - Implement CSP meta tags or HTTP headers
2. **Add Security Headers** - X-Frame-Options, X-Content-Type-Options, Referrer-Policy
3. **Add SRI to All External Resources** - Include integrity hashes for ApexCharts and Font Awesome

### Low Priority
1. **Replace Inline Event Handlers** - Use `addEventListener` instead of `onclick`
2. **Add HTML Escaping** - Use `html.escape()` for defensive programming
3. **Externalize JavaScript** - Move inline scripts to external files

---

## Implementation Checklist

- [ ] Add CSP meta tag to all HTML files
- [ ] Add security headers (X-Frame-Options, X-Content-Type-Options, Referrer-Policy)
- [ ] Add SRI hashes to ApexCharts CDN link
- [ ] Add SRI hashes to Font Awesome CDN link
- [ ] Replace inline `onclick` handlers with event listeners
- [ ] Add `html.escape()` to Python HTML generation (defensive)
- [ ] Consider externalizing JavaScript files
- [ ] Test all functionality after security header implementation

---

## Additional Notes

### Static Site Benefits
- No server-side vulnerabilities
- No database connections
- No authentication/authorization complexity
- No session management risks

### Deployment Considerations
If deploying to a web server:
- Configure security headers at the server level (Apache/Nginx)
- Use HTTPS (required for SRI)
- Consider using a CDN with security features
- Implement rate limiting if serving publicly

### Future Considerations
If the site is extended to include:
- User input forms ‚Üí Implement input validation and sanitization
- User authentication ‚Üí Follow OWASP authentication guidelines
- API endpoints ‚Üí Implement proper authentication and rate limiting
- Database ‚Üí Use parameterized queries, input validation

---

## Conclusion

The Engelberg Property Investment Simulation website is a **low-risk static site** with no critical security vulnerabilities. The main recommendations focus on **defense-in-depth** improvements:

1. Adding security headers for better protection
2. Implementing CSP to prevent XSS attacks
3. Adding SRI to all external resources
4. Following security best practices for maintainability

These improvements will enhance the security posture without significantly impacting functionality or performance.

---

**Next Steps**:
1. Review and prioritize recommendations
2. Implement medium-priority items
3. Test functionality after changes
4. Document security configuration for deployment

